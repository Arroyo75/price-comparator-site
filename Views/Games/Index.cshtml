@model IEnumerable<Game>

<div class="container py-4">
	<div class="d-flex justify-content-between align-items-center mb-4">
		<h1>Games</h1>
		<a asp-action="Create" class="btn btn-primary">Add New Game</a>
	</div>

	<div class="row row-cols-1 row-cols-md-3 g-4">

		@foreach(
			var game in Model
			.OrderByDescending(g => g.Prices.Any() ? g.Prices.Min(p => p.DiscountPercentage) ?? 0 :0)
		) {
	
				var lowestPrice = game.Prices?.OrderBy(p => p.CurrentPrice).FirstOrDefault();

				<div class="col">
					<div class="card h-100 shadow-sm">
						<div class="position-relative">

							<img src="@game.ImageUrl" class="card-img-top" style="height: 200px; object-fit: cover;" alt="@game.Name" />
					
							@if(lowestPrice?.DiscountPercentage>0) {
								<div class="position-absolute top-0 end-0 m-2">
									<span class="badge bg-danger">@(lowestPrice.DiscountPercentage)%</span>
								</div>
							}
						</div>
						<div class="card-body d-flex flex-column">
							<h5 class="card-title text-truncate" title="@game.Name">@game.Name</h5>
							<p class="card-text small text-muted mb-2">@game.Developer</p>
							@if(lowestPrice != null) {
								<div mt-auto>
									<div class="d-flex justify-content-between align-items-center">
										<div>
											<span class="fs-5 fw-bold">@lowestPrice.CurrentPrice.ToString("C")</span>
											@if(lowestPrice.OriginalPrice>lowestPrice.CurrentPrice) {
												<span class="text-muted text-decoration-line-through ms-2">@lowestPrice.OriginalPrice?.ToString("C")</span>
											}
										</div>
										<a asp-action="Details" asp-route-id="@game.Id" class="btn btn-outline-primary btn-sm">Compare Prices</a>
									</div>
								</div>
							} else {
								<p class="text-muted mt-auto">No prices available</p>
							}
						</div>
					</div>
				</div>
		}
	</div>
</div>

@*<table class="table">
	<thead>
		<tr>
			<th>Name</th>
			<th>Developer</th>
			<th>Image</th>
			<th>ReleaseDate</th>
			<th>Lowest Price</th>
			<th>Actions</th>
		</tr>
	</thead>
	<tbody>
		@foreach(var item in Model) {
			<tr>
				<td>@item.Name</td>
				<td>@item.Developer</td>
				<td><img src="@item.ImageUrl" alt="@item.Name" /></td>
				<td>@item.ReleaseDate.ToShortDateString()</td>
				<td>
					@{
						var lowestPrice = item.Prices.Any() ?
						item.Prices.Min(p => p.CurrentPrice).ToString("C") :
						"N/A";
					}
					@lowestPrice
				</td>
				<td>
					<a asp-action="Edit" asp-route-id="@item.Id" class="btn btn-sm btn-warning">Edit</a> |
					<a asp-action="Details" asp-route-id="@item.Id" class="btn btn-sm btn-info">Details</a>
					<a asp-action="Delete" asp-route-id="@item.Id" class="btn btn-sm btn-danger">Delete</a>
				</td>
			</tr>
		}
	</tbody>
</table>*@